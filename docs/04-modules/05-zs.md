# 中枢模块 (zs)

## 模块概述

`zs/` 模块负责中枢的识别和管理，中枢是缠论分析的核心概念。

---

## 目录结构

```
zs/
├── __init__.py
├── zs.py           # 中枢类
├── zs_list.py      # 中枢列表
└── zs_config.py    # 中枢配置
```

---

## 核心概念

### 什么是中枢？

中枢是多笔价格重叠形成的区间：
- 至少3笔有重叠
- 重叠区间称为中枢

```
中枢示意图:

        ●
       /|\
      / | \        ZG (中枢高点)
─────/──┼──\──────────────
    /   |   \
   ●    |    ●     中枢区间
    \   |   /
─────\──┼──/──────────────
      \ | /        ZD (中枢低点)
       \|/
        ●

GG: 中枢最高点（所有笔的最高）
DD: 中枢最低点（所有笔的最低）
ZG: 中枢高点（重叠区间上沿）
ZD: 中枢低点（重叠区间下沿）
```

---

## ZS 类

### 主要属性

```python
class ZS:
    begin: Bi             # 起始笔
    end: Bi               # 结束笔
    begin_bi: Bi          # 进入笔
    
    high: float           # 中枢高点 (ZG)
    low: float            # 中枢低点 (ZD)
    peak_high: float      # 最高点 (GG)
    peak_low: float       # 最低点 (DD)
    
    bi_in: Bi             # 进入中枢的笔
    bi_out: Bi            # 离开中枢的笔
    bi_lst: List[Bi]      # 中枢内的笔列表
    
    sub_zs_lst: List[ZS]  # 子中枢（合并前）
```

### 主要方法

```python
# 方向判断
zs.is_up()               # 是否上升中枢
zs.is_down()             # 是否下降中枢

# 位置判断
zs.in_range(value)       # 价格是否在中枢范围内
```

---

## 中枢算法

### 算法类型

| 算法 | 配置值 | 说明 |
|------|--------|------|
| 段内中枢 | "normal" | 中枢不跨线段（默认） |
| 跨段中枢 | "over_seg" | 中枢可以跨线段 |
| 自动 | "auto" | 确定部分normal，不确定部分over_seg |

### 段内中枢 (normal)

- 中枢起始笔方向与线段一致
- 中枢一定是奇数笔
- 中枢不跨越线段边界

### 跨段中枢 (over_seg)

- 中枢可以跨越线段
- 笔数可以是奇数或偶数
- 相邻中枢如果属于不同线段，不合并

---

## 中枢合并

当两个中枢有重叠时，可以合并：

```python
config = ChanConfig({
    "zs_combine": True,          # 是否合并
    "zs_combine_mode": "zs",     # 合并模式
})
```

### 合并模式

| 模式 | 说明 |
|------|------|
| "zs" | 中枢区间重叠才合并（默认） |
| "peak" | 有K线重叠就合并 |

---

## 配置参数

```python
config = ChanConfig({
    "zs_combine": True,          # 中枢合并
    "zs_combine_mode": "zs",     # 合并模式
    "one_bi_zs": False,          # 是否计算单笔中枢
    "zs_algo": "normal",         # 中枢算法
})
```

---

## 使用示例

### 获取中枢信息

```python
chan = Chan(...)

# 遍历所有线段的中枢
for seg in chan[0].seg_list:
    print(f"线段{seg.idx} 包含 {len(seg.zs_lst)} 个中枢")
    
    for zs in seg.zs_lst:
        print(f"  中枢: [{zs.low:.2f}, {zs.high:.2f}]")
        print(f"    极值: [{zs.peak_low:.2f}, {zs.peak_high:.2f}]")
        print(f"    笔数: {len(zs.bi_lst)}")
```

### 判断价格与中枢关系

```python
current_price = 10.5

for seg in chan[0].seg_list:
    for zs in seg.zs_lst:
        if zs.in_range(current_price):
            print(f"价格 {current_price} 在中枢 [{zs.low:.2f}, {zs.high:.2f}] 内")
        elif current_price > zs.high:
            print(f"价格在中枢上方")
        else:
            print(f"价格在中枢下方")
```

### 分析中枢特征

```python
# 找到最大的中枢
all_zs = []
for seg in chan[0].seg_list:
    all_zs.extend(seg.zs_lst)

if all_zs:
    # 按区间大小排序
    largest_zs = max(all_zs, key=lambda z: z.high - z.low)
    print(f"最大中枢: [{largest_zs.low:.2f}, {largest_zs.high:.2f}]")
    print(f"  区间: {largest_zs.high - largest_zs.low:.2f}")
```

### 中枢级别分析

```python
# 统计每个线段的中枢数量
for seg in chan[0].seg_list:
    zs_count = len(seg.zs_lst)
    if zs_count == 0:
        trend_type = "盘整"
    elif zs_count == 1:
        trend_type = "简单趋势"
    else:
        trend_type = "复杂趋势"
    
    print(f"线段{seg.idx}: {zs_count}个中枢, {trend_type}")
```

---

## 进出中枢的笔

```python
for seg in chan[0].seg_list:
    for zs in seg.zs_lst:
        if zs.bi_in:
            print(f"进入中枢的笔: {zs.bi_in.idx}")
            print(f"  方向: {'上' if zs.bi_in.is_up() else '下'}")
        
        if zs.bi_out:
            print(f"离开中枢的笔: {zs.bi_out.idx}")
            print(f"  方向: {'上' if zs.bi_out.is_up() else '下'}")
```

---

## 中枢与买卖点

中枢是判断买卖点的重要依据：

1. **一类买卖点**: 在中枢后出现背驰
2. **二类买卖点**: 回调不破一类买卖点（通常在中枢附近）
3. **三类买卖点**: 回调不进入中枢

```python
# 检查最后一笔是否回到中枢
last_bi = chan[0].bi_list[-1]
last_seg = chan[0].seg_list[-1]

if last_seg.zs_lst:
    last_zs = last_seg.zs_lst[-1]
    end_val = last_bi.get_end_val()
    
    if last_zs.in_range(end_val):
        print("最后一笔回到中枢内")
    elif (last_bi.is_down() and end_val > last_zs.high):
        print("最后一笔未进入中枢（可能是三类买点）")
```

---

## 下一步

- [买卖点模块](./06-buy-sell-point.md) - 了解买卖点计算
- [配置详解](../05-configuration/01-chan-config.md) - 中枢相关配置

